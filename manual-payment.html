<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manual Payment</title>

<style>
body{font-family:Arial;background:#f6f8fb;padding:20px}
.card{background:#fff;padding:20px;border-radius:14px;max-width:420px;margin:auto;box-shadow:0 4px 12px rgba(0,0,0,.05)}
p{margin:10px 0}
.copy{background:#00c896;color:#fff;border:none;padding:5px 8px;border-radius:6px;font-size:12px}
button.main{width:100%;padding:12px;border:none;border-radius:10px;background:#0a1f44;color:#fff;font-weight:bold;margin-top:15px}
</style>
</head>

<body>

<div class="card">
  <h3>Manual Investment Payment</h3>
  <p><b>Bank:</b> Paystack-Titan</p>
  <p><b>Account Number:</b> <span id="acc">9740116304</span>
    <button class="copy" onclick="copyText('9740116304')">Copy</button>
  </p>
  <p><b>Account Name:</b> MOREINFOPAY/Zyppayx</p>
  <p><b>Plan:</b> <span id="plan"></span></p>
  <p><b>Amount:</b> â‚¦<span id="amt"></span>
    <button class="copy" onclick="copyText(amount)">Copy</button>
  </p>
  <button class="main" id="submit">I Have Paid</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,doc,getDoc,collection,addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app=initializeApp({
  apiKey:"AIzaSyCQ8TCMUAySwLSBN3-0W1GV4XWateS1rqQ",
  authDomain:"zyppayx-69c54.firebaseapp.com",
  projectId:"zyppayx-69c54"
});
const auth=getAuth(app);
const db=getFirestore(app);

const params=new URLSearchParams(location.search);
const planId=params.get("planId");
const amount=Number(params.get("amount"));

document.getElementById("amt").textContent=amount.toLocaleString();

onAuthStateChanged(auth,async user=>{
  if(!user){location.href="login.html";return;}

  const planSnap=await getDoc(doc(db,"investmentPlans",planId));
  const plan=planSnap.data();
  document.getElementById("plan").textContent=plan.title;

  document.getElementById("submit").onclick=async()=>{
    const totalReturn=amount+(amount*plan.roiPercent/100);
    const start=Date.now();
    const end=start+(plan.duration*86400000);

    await addDoc(collection(db,"investments"),{
      planId,
      planTitle:plan.title,
      amount,
      roiPercent:plan.roiPercent,
      totalReturn,
      duration:plan.duration,
      startDate:start,
      endDate:end,
      status:"pending",
      userId:user.uid,
      userEmail:user.email,
      createdAt:Date.now()
    });

    alert("Investment recorded as pending. Await admin approval.");
    location.href="invest.html";
  };
});

window.copyText=(t)=>navigator.clipboard.writeText(t);
</script>
</body>
</html>
