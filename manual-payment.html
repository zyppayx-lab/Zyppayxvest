<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zyppayxvest | Manual Payment</title>
<style>
body { margin:0; font-family: Arial, Helvetica, sans-serif; background:#f6f8fb;}
header { background:#0a1f44;color:#fff;padding:20px;text-align:center;font-size:20px;}
.container { max-width:500px; margin:30px auto; padding:15px;}
.card { background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.05); padding:20px; margin-bottom:20px; }
.card p { margin:10px 0; font-size:14px; color:#333; display:flex; justify-content:space-between; align-items:center; }
.copy-btn { background:#00c896; color:#fff; padding:4px 10px; border-radius:6px; font-size:12px; cursor:pointer; border:none; margin-left:8px;}
.amount-input { width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #ddd; font-size:14px;}
button#submitPayment { width:100%; padding:12px; background:#0a1f44; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:bold;}
.loader-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); justify-content:center; align-items:center; z-index:1000; flex-direction:column;}
.loader { border:6px solid #f3f3f3; border-top:6px solid #00c896; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite;}
@keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
.success-tick { display:none; color:#00c896; font-size:50px; animation:scaleUp 0.5s forwards; margin-top:10px;}
@keyframes scaleUp { 0% { transform:scale(0); } 100% { transform:scale(1); } }
</style>
</head>
<body>

<header>Invest Into Zyppayx</header>

<div class="container">
  <div class="card">
    <p>
      <span><strong>Bank Name:</strong> Paystack-Titan</span>
    </p>
    <p>
      <span><strong>Account Number:</strong> <span id="accountNumber">9740116304</span></span>
      <button class="copy-btn" id="copyAccBtn">Copy</button>
    </p>
    <p>
      <span><strong>Account Name:</strong> MOREINFOPAY/Zyppayx</span>
    </p>
    <p>
      <span><strong>Amount to Pay:</strong></span>
      <input class="amount-input" type="number" id="amountInput" min="1000">
      <button class="copy-btn" id="copyAmtBtn">Copy</button>
    </p>
  </div>

  <button id="submitPayment">Submit Payment</button>
</div>

<div class="loader-overlay" id="loader">
  <div class="loader"></div>
  <p style="color:#fff; margin-top:10px;">Submitting your investment...</p>
  <div class="success-tick" id="successTick">&#10003;</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCQ8TCMUAySwLSBN3-0W1GV4XWateS1rqQ",
  authDomain: "zyppayx-69c54.firebaseapp.com",
  projectId: "zyppayx-69c54"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUserId = "";

// Get amount from localStorage if user came from invest.html
const prefillAmount = localStorage.getItem("investAmount") || "";
document.getElementById("amountInput").value = prefillAmount;

onAuthStateChanged(auth, user => {
  if(!user){ window.location.href="login.html"; return; }
  currentUserId = user.uid;
});

// Copy account number
document.getElementById("copyAccBtn").onclick = () => {
  const accNum = document.getElementById("accountNumber").textContent;
  navigator.clipboard.writeText(accNum).then(()=> alert("Account number copied!"));
};

// Copy amount
document.getElementById("copyAmtBtn").onclick = () => {
  const amt = document.getElementById("amountInput").value;
  if(!amt){ alert("Enter an amount first"); return; }
  navigator.clipboard.writeText(amt).then(()=> alert("Amount copied!"));
};

function showLoader(show){
  const loader = document.getElementById("loader");
  loader.style.display = show ? "flex" : "none";
  if(!show) document.getElementById("successTick").style.display = "none";
}

// Submit payment
document.getElementById("submitPayment").onclick = async () => {
  const amount = Number(document.getElementById("amountInput").value);
  if(!amount || amount < 1000){ alert("Enter an amount ≥ ₦1000"); return; }

  showLoader(true);

  try {
    await addDoc(collection(db, "users", currentUserId, "investments"), {
      planId: "Manual Payment",
      amount: amount,
      status: "pending",
      createdAt: serverTimestamp()
    });

    document.getElementById("successTick").style.display="block";

    setTimeout(()=>{
      showLoader(false);
      window.location.href="invest.html";
    },1500);

  } catch(e){
    showLoader(false);
    alert("Error recording investment. Try again.");
  }
};
</script>

</body>
</html>